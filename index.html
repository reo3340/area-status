<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>區域進度展示</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h2>區域進度展示</h2>
    <div class="map-container" id="mapContainer">
        <object data="./CTC_ELE.svg" type="image/svg+xml" id="map-svg"></object>
        <svg class="overlay-svg" id="overlaySvg">
            <defs>
                <mask id="holeMask">
                    <rect width="100%" height="100%" fill="white"/>
                    <!-- 挖空的區域會在這裡動態添加 -->
                </mask>
            </defs>
            <!-- 全圖遮罩 -->
            <rect width="100%" height="100%" class="full-mask" mask="url(#holeMask)"/>
            <!-- 可點擊區域 -->
            <g class="interactive-areas">
                <!-- 預設區域 -->
                <path class="area" id="area1" 
                    d="M430.95,332.77 L436.87,332.77 L436.87,337.96 L430.95,337.96 Z" 
                    data-name="區域1"/>
                <path class="area" id="area2" 
                    d="M436.87,332.77 L470.74,332.77 L470.74,337.96 L436.87,337.96 Z" 
                    data-name="區域2"/>
                <path class="area" id="area3" 
                    d="M430.95,337.96 L434.37,337.96 L434.37,346.35 L430.95,346.35 Z" 
                    data-name="區域3"/>
            </g>
        </svg>
        <div class="tooltip" id="tooltip"></div>
    </div>
    <div class="control-panel">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()">+</button>
            <button class="zoom-btn" onclick="zoomOut()">-</button>
            <button class="zoom-btn" onclick="resetZoom()">重設</button>
        </div>
        <div class="mask-controls">
            <button class="mask-btn" onclick="resetMasks()">重設遮罩</button>
        </div>
    </div>
    <div id="loading">載入中...</div>

    <script>
        let currentScale = 1.0;
        
        const mapContainer = document.getElementById('mapContainer');
        const mapSvg = document.getElementById('map-svg');
        const overlaySvg = document.getElementById('overlaySvg');
        const interactiveAreas = overlaySvg.querySelector('.interactive-areas');
        const holeMask = document.querySelector('#holeMask');

        // 修正 SVG 的寬高比例
        mapSvg.addEventListener('load', function() {
            const svgDoc = mapSvg.contentDocument;
            if (svgDoc) {
                const svgElement = svgDoc.querySelector('svg');
                if (svgElement) {
                    const viewBox = svgElement.getAttribute('viewBox');
                    if (viewBox) {
                        overlaySvg.setAttribute('viewBox', viewBox);
                    }
                }
            }
        });

        // 為每個區域添加點擊事件
        interactiveAreas.querySelectorAll('.area').forEach(area => {
            area.addEventListener('click', function() {
                toggleAreaMask(this);
            });

            // 添加懸停提示
            area.addEventListener('mouseenter', function(e) {
                showTooltip(e, this.getAttribute('data-name'));
            });

            area.addEventListener('mouseleave', function() {
                hideTooltip();
            });
        });

        function toggleAreaMask(area) {
            const areaId = area.id;
            const existingHole = holeMask.querySelector(`#hole-${areaId}`);
            
            if (existingHole) {
                // 如果已經有洞，就填回去（恢復遮罩）
                existingHole.remove();
                area.classList.remove('completed');
            } else {
                // 如果還沒有洞，就挖一個（移除遮罩）
                const hole = document.createElementNS("http://www.w3.org/2000/svg", "path");
                hole.setAttribute("id", `hole-${areaId}`);
                hole.setAttribute("d", area.getAttribute("d"));
                hole.setAttribute("fill", "black");
                holeMask.appendChild(hole);
                area.classList.add('completed');
            }
        }

        function resetMasks() {
            if (confirm('確定要重設所有遮罩嗎？')) {
                // 清除所有洞
                while (holeMask.children.length > 1) {
                    holeMask.removeChild(holeMask.lastChild);
                }
                // 移除所有完成標記
                interactiveAreas.querySelectorAll('.area').forEach(area => {
                    area.classList.remove('completed');
                });
            }
        }

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY + 10) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        function updateZoom() {
            mapSvg.style.width = (100 * currentScale) + '%';
            mapSvg.style.height = (100 * currentScale) + '%';
            overlaySvg.style.width = (100 * currentScale) + '%';
            overlaySvg.style.height = (100 * currentScale) + '%';
        }

        function zoomIn() {
            currentScale *= 1.2;
            updateZoom();
        }

        function zoomOut() {
            currentScale /= 1.2;
            if (currentScale < 1) currentScale = 1;
            updateZoom();
        }

        function resetZoom() {
            currentScale = 1.0;
            updateZoom();
        }

        // 初始化
        updateZoom();
    </script>
</body>
</html>
