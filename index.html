<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>區域進度展示</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h2>區域進度展示</h2>
    <div class="map-container">
        <object data="images/CTC_ELE.svg" type="image/svg+xml" id="map-svg"></object>
        <svg class="overlay-svg">
            <g class="interactive-areas"></g>
        </svg>
        <div class="tooltip" id="tooltip"></div>
    </div>
    <div class="control-panel">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()">+</button>
            <button class="zoom-btn" onclick="zoomOut()">-</button>
            <button class="zoom-btn" onclick="resetZoom()">重設</button>
        </div>
        <div class="mask-controls">
            <button class="mask-btn" onclick="toggleMaskMode()">新增遮罩</button>
            <button class="mask-btn" onclick="clearMasks()">清除遮罩</button>
        </div>
    </div>
    <div id="loading">載入中...</div>

    <script src="js/main.js"></script>
    <script>
        let currentScale = 1.0;
        let isDrawingMask = false;
        let startPoint = null;
        const mapSvg = document.getElementById('map-svg');
        const overlaySvg = document.querySelector('.overlay-svg');
        const interactiveAreas = document.querySelector('.interactive-areas');

        function toggleMaskMode() {
            isDrawingMask = !isDrawingMask;
            document.querySelector('button[onclick="toggleMaskMode()"]').textContent = 
                isDrawingMask ? '完成繪製' : '新增遮罩';
            document.body.style.cursor = isDrawingMask ? 'crosshair' : 'default';
        }

        function clearMasks() {
            if (confirm('確定要清除所有遮罩嗎？')) {
                interactiveAreas.innerHTML = '';
            }
        }

        overlaySvg.addEventListener('mousedown', function(e) {
            if (!isDrawingMask) return;
            const rect = overlaySvg.getBoundingClientRect();
            startPoint = {
                x: (e.clientX - rect.left) / currentScale,
                y: (e.clientY - rect.top) / currentScale
            };
        });

        overlaySvg.addEventListener('mousemove', function(e) {
            if (!isDrawingMask || !startPoint) return;
            const rect = overlaySvg.getBoundingClientRect();
            const currentPoint = {
                x: (e.clientX - rect.left) / currentScale,
                y: (e.clientY - rect.top) / currentScale
            };

            // 更新或創建臨時遮罩
            let tempMask = document.getElementById('tempMask');
            if (!tempMask) {
                tempMask = document.createElementNS("http://www.w3.org/2000/svg", "path");
                tempMask.setAttribute("id", "tempMask");
                tempMask.setAttribute("class", "area");
                interactiveAreas.appendChild(tempMask);
            }

            const path = `M${startPoint.x},${startPoint.y} L${currentPoint.x},${startPoint.y} L${currentPoint.x},${currentPoint.y} L${startPoint.x},${currentPoint.y} Z`;
            tempMask.setAttribute("d", path);
        });

        overlaySvg.addEventListener('mouseup', function(e) {
            if (!isDrawingMask || !startPoint) return;
            const rect = overlaySvg.getBoundingClientRect();
            const endPoint = {
                x: (e.clientX - rect.left) / currentScale,
                y: (e.clientY - rect.top) / currentScale
            };

            // 創建最終的遮罩
            const mask = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const path = `M${startPoint.x},${startPoint.y} L${endPoint.x},${startPoint.y} L${endPoint.x},${endPoint.y} L${startPoint.x},${endPoint.y} Z`;
            
            mask.setAttribute("d", path);
            mask.setAttribute("class", "area");
            mask.setAttribute("id", "mask" + Date.now());
            mask.setAttribute("data-name", "遮罩區域");
            
            interactiveAreas.appendChild(mask);

            // 移除臨時遮罩
            const tempMask = document.getElementById('tempMask');
            if (tempMask) tempMask.remove();

            startPoint = null;
        });

        function updateZoom() {
            mapSvg.style.width = (100 * currentScale) + '%';
            mapSvg.style.height = (100 * currentScale) + '%';
            overlaySvg.style.width = (100 * currentScale) + '%';
            overlaySvg.style.height = (100 * currentScale) + '%';
        }

        function zoomIn() {
            currentScale *= 1.2;
            updateZoom();
        }

        function zoomOut() {
            currentScale /= 1.2;
            if (currentScale < 1) currentScale = 1;
            updateZoom();
        }

        function resetZoom() {
            currentScale = 1.0;
            updateZoom();
        }

        // 初始化縮放
        updateZoom();
    </script>
</body>
</html>
